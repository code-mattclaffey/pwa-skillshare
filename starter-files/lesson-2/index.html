<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>PWA Kata</title>
		<meta name="description" content="PWA Kata">
		<link href="/style.css" type="text/css" rel="stylesheet">
		<link rel="manifest" href="/manifest.json">
		<meta name="theme-color" content="#304ffe">
		<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
	</head>
	<body>
		<div class="grid">
			<div class="grid__block" style="background-color: #304ffe;">
				<img src="/pwa-lighthouse.png" class="logo" alt="Logo"/>
			</div>
			<div class="grid__block">
				<main class="content">
					<h1>PWA Kata</h1>
					<div class="step step--visible" data-test-section>
						<h2>Step One - Get this deployed on <a href="https://zeit.co/now" target="_blank">Now - Realtime Global Deployments</a></h2>

						<p>An introduction in building your first PWA web app. Shall we start?</p>

						<p>We need to be able to deploy our app to a domain with https so we can test our PWA application. Also its nice just to see the expierence work on a phone. You will need to start deploying your app from step three.</p>

						<p>Setting up an account is free. Each time you deploy the url is a different url so copy the one thats in the commanline once you've ran <b>npm run deploy-l2</b>.</p>

						<button type="button" class="pwa-btn" data-test-btn="now">I am setup</button>
					</div>
					<div class="step" data-test-section>
						<h2>Step Two - Build a add to homescreen prompt</h2>

						<p>So, we have a manifest file from the previous lesson and what we expect now is a small add to homescreen popup in the footer of our page. Chrome has a new feature which will allow the user to have control of when to show the add to homescreen by adding custom UI asking the user to install the app.</p>

						<p>Why is this a good feature then? This gives us the ability to track when users accept and decline the add to homescreen banner and more users will engage with the banner due to it looking more on brand. Other browsers will fallback to using the default behaviour so this is an enhancement for browsers that support the feature. Example: <a href="https://developers.google.com/web/fundamentals/app-install-banners/" target="_blank">app install banners</a></p>

						<ul class="tests" data-test-errors>
						</ul>
						<button type="button" class="pwa-btn" data-aths-prompt style="display: none;">Trigger Prompt</button>
					</div>
					<div class="step" data-test-section="indexDB">
						<h2>Saving our form data into indexDB</h2>
						<p>Awesome! You made it past the app install banner!</p>
						<p>Next we are going to create a form which will save data and send it to the user when they become online again. This is going to be broken down into two sections where section one; we add our form data into indexDB and then two we post that data when we become online again.</p>

						<!-- Deploy your server first -->
						<p data-form-completed style="display: none;">Submission successfully submitted!</p>
						<form action="https://nodejs-express-irsxprgxau.now.sh/save" method="POST">
							<fieldset>
								<legend>Your Name</legend>
								<div>
									<label for="first-name">First Name</label>
									<input type="text" id="first-name" name="firstName" required/>
								</div>
								<div>
									<label for="last-name">Last Name</label>
									<input type="text" id="last-name" name="lastName" required/>
								</div>
								<button type="submit" class="pwa-btn">Send</button>
							</fieldset>
						</form>
					</div>
				</main>
			</div>
		</div>
		<script src="/main.js" defer></script>

		<script>
			if('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/sw.js')
				.then(function(reg) {
					console.log('Service worker registered', reg);
				})
				.catch(function(err) {
					console.log('Error registering service worker', err);
				});


			/**********
			 *
			 *  STEP 2.5
			 *
			 * *********/

			// we need to use the navigator.serviceWorker.ready which returns a promise with a registration parameter passed into the fucking.
			// once passed we need to return registration.sync.register('sendFormData')
			// we then need to use another .then to console log whether the sync has been registered or not. just a console log will do for now.
			// finally we need to use .catch to console log the sync reg failed.
			}
		</script>
	</body>
</html>
